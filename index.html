<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Sally æ‰‘å‚»ç“œ</title>
<style>
body { font-family: sans-serif; text-align: center; background: #fce4ec; }
h1 { margin-top:20px; }
#game-container { width: 300px; margin: auto; display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-top: 30px;}
.hole { position: relative; width: 100px; height: 100px; border-radius: 50%; background: #795548; overflow: hidden; cursor: pointer; }
.hole.active { background: #5d4037; }
.target { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5rem; display: none; }
.hole.active .target { display: block; }
#scoreboard { margin-top: 20px; font-size: 1.2rem; }
#start-btn { margin-top: 20px; padding: 10px 20px; font-size: 1rem; cursor: pointer; }
</style>
</head>
<body>
<h1>Sally æ‰‘å‚»ç“œ</h1>
<div id="scoreboard">
åˆ†æ•¸: <span id="score">0</span> | å›åˆ: <span id="round">0</span>/5 | æ™‚é–“: <span id="time">30</span>
</div>
<button id="start-btn">é–‹å§‹éŠæˆ²</button>
<div id="game-container"></div>
<script>
const gameContainer = document.getElementById('game-container');
const scoreElem = document.getElementById('score');
const timeElem = document.getElementById('time');
const roundElem = document.getElementById('round');
const startBtn = document.getElementById('start-btn');
let score = 0;
let time = 30;
let round = 0;
const maxRounds = 5;
let gameInterval;
let targetTimeout;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(freq) {
  const oscillator = audioCtx.createOscillator();
  oscillator.type = 'square';
  oscillator.frequency.value = freq;
  oscillator.connect(audioCtx.destination);
  oscillator.start();
  oscillator.stop(audioCtx.currentTime + 0.15);
}
function createHoles() {
  gameContainer.innerHTML = '';
  for (let i = 0; i < 9; i++) {
    const hole = document.createElement('div');
    hole.classList.add('hole');
    const target = document.createElement('div');
    target.classList.add('target');
    target.textContent = '';
    hole.appendChild(target);
    hole.addEventListener('click', () => {
      if (hole.classList.contains('active')) {
        const char = target.textContent;
        if (char === 'ğŸ°') {
          score++;
          playTone(800);
        } else if (char === 'ğŸ­') {
          score--;
          playTone(300);
        }
        scoreElem.textContent = score;
        hole.classList.remove('active');
        target.textContent = '';
      } else {
        playTone(400);
      }
    });
    gameContainer.appendChild(hole);
  }
}
function randomHole() {
  const holes = document.querySelectorAll('.hole');
  const idx = Math.floor(Math.random() * holes.length);
  return holes[idx];
}
function showTarget() {
  const hole = randomHole();
  const target = hole.querySelector('.target');
  hole.classList.add('active');
  if (Math.random() < 0.7) {
    target.textContent = 'ğŸ°';
  } else {
    target.textContent = 'ğŸ­';
  }
  targetTimeout = setTimeout(() => {
    hole.classList.remove('active');
    target.textContent = '';
    showTarget();
  }, 800);
}
function startRound() {
  round++;
  roundElem.textContent = round;
  time = 30;
  timeElem.textContent = time;
  document.querySelectorAll('.hole').forEach(hole => {
    hole.classList.remove('active');
    const t = hole.querySelector('.target');
    if (t) t.textContent = '';
  });
  showTarget();
  gameInterval = setInterval(() => {
    time--;
    timeElem.textContent = time;
    if (time <= 0) {
      clearInterval(gameInterval);
      clearTimeout(targetTimeout);
      if (round < maxRounds) {
        alert('å›åˆ ' + round + ' çµæŸ! ç•¶å‰åˆ†æ•¸: ' + score);
        startRound();
      } else {
        alert('éŠæˆ²çµæŸ! ç¸½åˆ†: ' + score);
      }
    }
  }, 1000);
}
function startGame() {
  score = 0;
  round = 0;
  scoreElem.textContent = score;
  startRound();
}
startBtn.addEventListener('click', startGame);
createHoles();
</script>
</body>
</html>
